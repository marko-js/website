<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="The Marko programming language"><title>Immutable Data in State | Marko</title><link rel=icon sizes=32x32 href=/fav.png><link rel=icon type=image/svg+xml href=/fav.svg><link rel=preconnect href=https://GB0QQV5RQM-dsn.algolia.net crossorigin><script async type="module" crossorigin src="/assets/docs.explanation.immutable-state-D_GFhAoq.js"></script><link rel="modulepreload" crossorigin href="/assets/_DXYJlE3B.js"><link rel="modulepreload" crossorigin href="/assets/_D4OQmHgy.js"><link rel="modulepreload" crossorigin href="/assets/_THfjy09c.js"><link rel="stylesheet" crossorigin href="/assets/_layout-BJiym8XD.css"><link rel="stylesheet" crossorigin href="/assets/_layout-hmI-Y7H7.css"><link rel="stylesheet" crossorigin href="/assets/app-code-block-DzvS1Xn3.css"></head><body><div id=root><header id=header><a title=Home href="/" id=_cT><picture><source srcset=/logo.svg#dark media=(prefers-color-scheme:dark)><img alt="Marko Logo" src=/logo.svg></picture></a><div class=_cR><a href=/docs>Docs</a><a href=/playground>Playground</a><a href=https://github.com/marko-js/marko>GitHub</a></div><button aria-pressed=false aria-label="Show menu" id=_cS></button><!--M_*6 2--><div id=_cU><button disabled aria-hidden=true></button></div><!--M_*6 3--></header><main><script>document.documentElement.classList.toggle("concise-mode",localStorage.getItem("concise-mode")==='true');</script><script>document.documentElement.classList.toggle("ts-mode",localStorage.getItem("ts-mode")==='true');</script><div class=_de id=site-menu><nav class=_df id=_dg><ul><li><strong>Introduction</strong><ul><li><a href=/docs/introduction/getting-started>Getting Started</a></li><li><a href=/docs/introduction/welcome-to-marko>Welcome to Marko!</a></li><li><a href=/docs/introduction/installation>Installation</a></li><li><a href=/docs/introduction/why-marko>Why Marko?</a></li><li><a href=/docs/introduction/integrations>Integrations</a></li></ul></li><li><strong>Tutorials</strong><ul><li><a href=/docs/tutorial/fundamentals>Fundamentals</a></li><li><a href=/docs/tutorial/components-and-reactivity>Components and Reactivity</a></li></ul></li><li><strong>Guides</strong><ul><li><a href=/docs/guide/styling>Styling</a></li></ul></li><li><strong>Explanation</strong><ul><li><a href=/docs/explanation/streaming>Streaming</a></li><li><a href=/docs/explanation/targeted-compilation>Targeted Compilation</a></li><li><a href=/docs/explanation/fine-grained-bundling>Fine-Grained Bundling</a></li><li><a href=/docs/explanation/separation-of-concerns>Separation of Concerns</a></li><li><a href=/docs/explanation/controllable-components>Controllable Components</a></li><li><a href=/docs/explanation/nested-reactivity>Nested Reactivity</a></li><li><a href=/docs/explanation/immutable-state aria-current=true>Immutable State</a></li><li><a href=/docs/explanation/serializable-state>Serializable State</a></li></ul></li><li><strong>Reference</strong><ul><li><a href=/docs/reference/language>Language</a></li><li><a href=/docs/reference/custom-tag>Custom Tags</a></li><li><a href=/docs/reference/reactivity>Reactivity</a></li><li><a href=/docs/reference/core-tag>Core Tags</a></li><li><a href=/docs/reference/native-tag>Native Tags</a></li><li><a href=/docs/reference/concise-syntax>Concise Syntax</a></li><li><a href=/docs/reference/template>Template API</a></li><li><a href=/docs/reference/typescript>TypeScript</a></li></ul></li><li><strong>Marko Run</strong><ul><li><a href=/docs/marko-run/getting-started>Getting Started</a></li><li><a href=/docs/marko-run/file-based-routing>File-based Routing</a></li><li><a href=/docs/marko-run/typescript>TypeScript</a></li></ul></li></ul></nav><div id=_di><label class=_dj>Version&nbsp;<select><option value selected>6.x</option><option value=https://v5.markojs.com/docs/getting-started>5.x</option><option value="http://marko-v4.github.io/docs/">4.x</option><option value="http://v3.markojs.com/docs/">3.x</option><option value="http://marko-v2.github.io/docs/">2.x</option></select><!--M_*7 37--></label><label class=_n><span>HTML<!--M_*66 1--></span><span class=_m><input type=checkbox aria-label="Toggle Concise mode"><!--M_*66 3--><svg viewBox="0 0 576 512"><path d="M384 128c70.7 0 128 57.3 128 128S454.7 384 384 384l-192 0c-70.7 0-128-57.3-128-128s57.3-128 128-128l192 0zM576 256c0-106-86-192-192-192L192 64C86 64 0 150 0 256S86 448 192 448l192 0c106 0 192-86 192-192zM192 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"></path></svg><!--M_*67 0--></span><span>Concise<!--M_*66 5--></span></label><label class=_n><span>JS<!--M_*69 1--></span><span class=_m><input type=checkbox aria-label="Toggle TS mode"><!--M_*69 3--><svg viewBox="0 0 576 512"><path d="M384 128c70.7 0 128 57.3 128 128S454.7 384 384 384l-192 0c-70.7 0-128-57.3-128-128s57.3-128 128-128l192 0zM576 256c0-106-86-192-192-192L192 64C86 64 0 150 0 256S86 448 192 448l192 0c106 0 192-86 192-192zM192 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"></path></svg><!--M_*70 0--></span><span>TS<!--M_*69 5--></span></label></div></div><article id=_dl><h1 id=immutable-data-in-state>Immutable Data in State</h1><callout role=note aria-labelledby=callout-cot-0 class=admonition-tldr><cot id=callout-cot-0>TL;DR</cot><ul><li>Immutable updates prevent hidden side effects</li><li>UI as a function of state requires immutability</li><li>Server-to-client handoff needs serializable state</li></ul></callout><p>Marko encourages treating application state as immutable, plain data. This aligns the render model with functional programming: the UI is a deterministic function of inputs and state. It also allows the compiler and runtime to optimize updates and safely hand work between server and client.</p><section id=immutability><h2><a href=#immutability>Immutability</a></h2><p>Immutable updates replace data instead of mutating it in place. This avoids hidden coupling, makes changes easier to reason about, and ensures updates are detected.</p><p>Consider this Marko template. Reassigning the array triggers an update; mutating in place does not.</p><div class=code-block><div class=filename>list.marko</div><div class="html html-ts"><pre class="shiki shiki-themes marko-light marko-dark s_a" tabindex="0"><code><span class="line"><span class="s_0">&#x3C;</span><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">items=</span><span class="s_0">[</span><span class="s_3">"alpha"</span><span class="s_0">, </span><span class="s_3">"beta"</span><span class="s_0">]></span></span>
<span class="line"></span>
<span class="line"><span class="s_0">&#x3C;</span><span class="s_4">ul</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">  &#x3C;</span><span class="s_4">for</span><span class="s_0">|</span><span class="s_5">item</span><span class="s_0">| </span><span class="s_6">of</span><span class="s_2">=items</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">    &#x3C;</span><span class="s_4">li</span><span class="s_0">></span><span class="s_1">${</span><span class="s_2">item</span><span class="s_1">}</span><span class="s_0">&#x3C;/</span><span class="s_4">li</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">  &#x3C;/</span><span class="s_4">for</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">  &#x3C;</span><span class="s_4">button</span><span class="s_7"> onClick</span><span class="s_0">() {</span></span>
<span class="line"><span class="s_8">    // ❌ BAD: in-place mutation</span></span>
<span class="line"><span class="s_2">    items</span><span class="s_0">.</span><span class="s_9">push</span><span class="s_0">(</span><span class="s_3">"gamma"</span><span class="s_0">)</span></span>
<span class="line"></span>
<span class="line"><span class="s_8">    // ✅ GOOD: immutable update</span></span>
<span class="line"><span class="s_2">    items</span><span class="s_2"> =</span><span class="s_2"> items</span><span class="s_0">.</span><span class="s_9">concat</span><span class="s_0">(</span><span class="s_3">"gamma"</span><span class="s_0">);</span></span>
<span class="line"><span class="s_0">  }></span></span>
<span class="line"><span class="s_0">    Add</span></span>
<span class="line"><span class="s_0">  &#x3C;/</span><span class="s_4">button</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">&#x3C;/</span><span class="s_4">ul</span><span class="s_0">></span></span></code></pre></div><div class="concise concise-ts"><pre class="shiki shiki-themes marko-light marko-dark s_a" tabindex="0"><code><span class="line"><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">items=</span><span class="s_0">[</span><span class="s_3">"alpha"</span><span class="s_0">, </span><span class="s_3">"beta"</span><span class="s_0">]</span></span>
<span class="line"></span>
<span class="line"><span class="s_4">ul</span></span>
<span class="line"><span class="s_4">  for</span><span class="s_0">|</span><span class="s_5">item</span><span class="s_0">| </span><span class="s_6">of</span><span class="s_2">=items</span></span>
<span class="line"><span class="s_4">    li</span><span class="s_0"> -- </span><span class="s_1">${</span><span class="s_2">item</span><span class="s_1">}</span></span>
<span class="line"><span class="s_4">  button</span><span class="s_7"> onClick</span><span class="s_0">() {</span></span>
<span class="line"><span class="s_8">    // ❌ BAD: in-place mutation</span></span>
<span class="line"><span class="s_2">    items</span><span class="s_0">.</span><span class="s_9">push</span><span class="s_0">(</span><span class="s_3">"gamma"</span><span class="s_0">)</span></span>
<span class="line"></span>
<span class="line"><span class="s_8">    // ✅ GOOD: immutable update</span></span>
<span class="line"><span class="s_2">    items</span><span class="s_2"> =</span><span class="s_2"> items</span><span class="s_0">.</span><span class="s_9">concat</span><span class="s_0">(</span><span class="s_3">"gamma"</span><span class="s_0">);</span></span>
<span class="line"><span class="s_0">  }</span></span>
<span class="line"><span class="s_0">    -- Add</span></span></code></pre></div></div><style>.s_0{--shiki-light:#202124;--shiki-dark:#FFF}.s_1{--shiki-light:#0D7BBF;--shiki-dark:#66D9EF}.s_2{--shiki-light:#202124;--shiki-dark:#FFFFFF}.s_3{--shiki-light:#8A720A;--shiki-dark:#FFF066}.s_4{--shiki-light:#D91880;--shiki-dark:#FF4185}.s_5{--shiki-light:#B05C1C;--shiki-light-font-style:italic;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic}.s_6{--shiki-light:#46821C;--shiki-dark:#A6E22E}.s_7{--shiki-light:#0D7BBF;--shiki-light-font-style:italic;--shiki-dark:#66D9EF;--shiki-dark-font-style:italic}.s_8{--shiki-light:#73738C;--shiki-dark:#8F8F9E}.s_9{--shiki-light:#1D8649;--shiki-dark:#7FFF00}.s_a{--shiki-light:#202124;--shiki-dark:#FFF;--shiki-light-bg:#00000000;--shiki-dark-bg:#00000000}</style><p>Immutable updates work naturally with Marko&#39;s assignment-based reactivity. Replacing a value (object, array, map-like structure) makes change propagation explicit and reliable.</p></section><section id=functional-ui><h2><a href=#functional-ui>Functional UI</a></h2><p>In modern UI frameworks, developers are encouraged to view the <strong>rendered output</strong> as a <strong>function of state</strong>. This works when state changes are visible and do not carry implicit side effects. In-place mutation breaks that mental model and can hide when and where the view should update.</p><div class=code-block><div class=filename>profile.marko</div><div class="html html-ts"><pre class="shiki shiki-themes marko-light marko-dark s_a" tabindex="0"><code><span class="line"><span class="s_0">&#x3C;</span><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">user=</span><span class="s_0">{ name: </span><span class="s_3">"Ada"</span><span class="s_0">, clicks: </span><span class="s_b">0</span><span class="s_0"> }></span></span>
<span class="line"></span>
<span class="line"><span class="s_0">&#x3C;</span><span class="s_4">p</span><span class="s_0">>Hello, </span><span class="s_1">${</span><span class="s_2">user</span><span class="s_0">.</span><span class="s_2">name</span><span class="s_1">}</span><span class="s_0">! (</span><span class="s_1">${</span><span class="s_2">user</span><span class="s_0">.</span><span class="s_2">clicks</span><span class="s_1">}</span><span class="s_0"> clicks)&#x3C;/</span><span class="s_4">p</span><span class="s_0">></span></span>
<span class="line"></span>
<span class="line"><span class="s_0">&#x3C;</span><span class="s_4">button</span><span class="s_7"> onClick</span><span class="s_0">() {</span></span>
<span class="line"><span class="s_8">  // ❌ BAD: in-place mutation</span></span>
<span class="line"><span class="s_2">  user</span><span class="s_0">.</span><span class="s_2">clicks</span><span class="s_4">++</span><span class="s_0">;</span></span>
<span class="line"></span>
<span class="line"><span class="s_8">  // ✅ GOOD: immutable update</span></span>
<span class="line"><span class="s_2">  user</span><span class="s_2"> =</span><span class="s_0"> { </span><span class="s_4">...</span><span class="s_2">user</span><span class="s_0">, clicks: </span><span class="s_2">user</span><span class="s_0">.</span><span class="s_2">clicks</span><span class="s_4"> +</span><span class="s_b"> 1</span><span class="s_0"> };</span></span>
<span class="line"><span class="s_0">}></span></span>
<span class="line"><span class="s_0">  Visit</span></span>
<span class="line"><span class="s_0">&#x3C;/</span><span class="s_4">button</span><span class="s_0">></span></span></code></pre></div><div class="concise concise-ts"><pre class="shiki shiki-themes marko-light marko-dark s_a" tabindex="0"><code><span class="line"><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">user=</span><span class="s_0">{ name: </span><span class="s_3">"Ada"</span><span class="s_0">, clicks: </span><span class="s_b">0</span><span class="s_0"> }</span></span>
<span class="line"></span>
<span class="line"><span class="s_4">p</span><span class="s_0"> -- Hello, </span><span class="s_1">${</span><span class="s_2">user</span><span class="s_0">.</span><span class="s_2">name</span><span class="s_1">}</span><span class="s_0">! (</span><span class="s_1">${</span><span class="s_2">user</span><span class="s_0">.</span><span class="s_2">clicks</span><span class="s_1">}</span><span class="s_0"> clicks)</span></span>
<span class="line"></span>
<span class="line"><span class="s_4">button</span><span class="s_7"> onClick</span><span class="s_0">() {</span></span>
<span class="line"><span class="s_8">  // ❌ BAD: in-place mutation</span></span>
<span class="line"><span class="s_2">  user</span><span class="s_0">.</span><span class="s_2">clicks</span><span class="s_4">++</span><span class="s_0">;</span></span>
<span class="line"></span>
<span class="line"><span class="s_8">  // ✅ GOOD: immutable update</span></span>
<span class="line"><span class="s_2">  user</span><span class="s_2"> =</span><span class="s_0"> { </span><span class="s_4">...</span><span class="s_2">user</span><span class="s_0">, clicks: </span><span class="s_2">user</span><span class="s_0">.</span><span class="s_2">clicks</span><span class="s_4"> +</span><span class="s_b"> 1</span><span class="s_0"> };</span></span>
<span class="line"><span class="s_0">}</span></span>
<span class="line"><span class="s_0">  -- Visit</span></span></code></pre></div></div><style>.s_b{--shiki-light:#7C4DFF;--shiki-dark:#AE81FF}</style><p>By replacing <code>user</code>, the view updates deterministically as a function of the new state.</p></section><section id=serialization><h2><a href=#serialization>Serialization</a></h2><p>To pass work from server to client, state must be serialized. Only serializable data can be reliably embedded into HTML and later hydrated. Class instances, DOM nodes, and some types of closures cannot be serialized and should not be stored in state.</p><div class=code-block><div class=filename>cart.marko</div><div class="html html-ts"><pre class="shiki shiki-themes marko-light marko-dark s_a" tabindex="0"><code><span class="line"><span class="s_8">// ✅ GOOD: serializable data</span></span>
<span class="line"><span class="s_0">&#x3C;</span><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">cart=</span><span class="s_0">{ items: [{ id: </span><span class="s_b">1</span><span class="s_0">, qty: </span><span class="s_b">2</span><span class="s_0"> }] }></span></span>
<span class="line"><span class="s_8">// ❌ BAD: unserializable in state (class/function/DOM)</span></span>
<span class="line"><span class="s_0">&#x3C;</span><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">cart=</span><span class="s_4">new</span><span class="s_2"> Cart</span><span class="s_0">([{ id: </span><span class="s_b">1</span><span class="s_0">, qty: </span><span class="s_b">2</span><span class="s_0"> }])></span></span></code></pre></div><div class="concise concise-ts"><pre class="shiki shiki-themes marko-light marko-dark s_a" tabindex="0"><code><span class="line"><span class="s_8">// ✅ GOOD: serializable data</span></span>
<span class="line"><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">cart=</span><span class="s_0">{ items: [{ id: </span><span class="s_b">1</span><span class="s_0">, qty: </span><span class="s_b">2</span><span class="s_0"> }] }</span></span>
<span class="line"><span class="s_8">// ❌ BAD: unserializable in state (class/function/DOM)</span></span>
<span class="line"><span class="s_1">let</span><span class="s_0">/</span><span class="s_2">cart=</span><span class="s_4">new</span><span class="s_2"> Cart</span><span class="s_0">([{ id: </span><span class="s_b">1</span><span class="s_0">, qty: </span><span class="s_b">2</span><span class="s_0"> }])</span></span></code></pre></div></div><p>Keeping state serializable enables streaming HTML on the server and interactive handoff in the browser without brittle custom hydration logic.</p><callout role=note aria-labelledby=callout-cot-1 class=admonition-tip><cot id=callout-cot-1>Tip</cot><p>For details on what data is supported and patterns to avoid, see <a href=./serializable-state>serializable state</a></p></callout></section><section id=further-reading><h2><a href=#further-reading>Further Reading</a></h2><ul><li><a href=../reference/reactivity>Reactivity</a></li><li><a href=./nested-reactivity>Nested Reactivity</a></li><li><a href=./fine-grained-bundling>Fine-Grained Bundling</a></li></ul></section><hr><section id=_dm><h2 id=contributors><a href=#contributors>Contributors</a></h2><p>Helpful? You can thank these awesome people! You can also edit this doc if you see any issues or want to improve it.</p><script>(e=>(self[e]||(self[e]=(l,f=e+l,s=f.length,a={},d=[],t=document,n=t.createTreeWalker(t,129))=>t=self[e][l]={i:f,d:t,l:a,v:d,x(){},w(e,l,r){for(;e=n.nextNode();)t.x(l=(l=e.data)&&!l.indexOf(f)&&(a[r=l.slice(s+1)]=e,l[s]),r,e),l>"#"&&d.push(e)}}),self[e]))("M")("_");M._.r=[_=>(_.g=[{params:{},url:new URL("http://localhost/docs/explanation/immutable-state")},5,{4:!1},_.h={0:_.a={3:"concise-mode"},1:9,3:_.b={3:"ts-mode"},4:11,38:_.d={10:_.c={"aria-label":"Toggle Concise mode",checked:!1},f3:0},39:_.f={10:_.e={"aria-label":"Toggle TS mode",checked:!1},f3:0},40:!1,41:!1},_.a,1,_.b,55,_.d,{5:{},7:576,8:512},1,_.f,{5:{},7:576,8:512},23,{5:"immutability"},{5:"functional-ui"},{5:"serialization"},{5:"further-reading"}],_.a.f=_._.e0(_.a),_.a.e=_._.o2(_.h),_.b.f=_._.e0(_.b),_.b.e=_._.o3(_.h),_.c.checkedChange=_.d.e3=_._.o0(_.h),_.e.checkedChange=_.f.e3=_._.o1(_.h),_.g),"h0",5,"n0",6,"n1",6,"e1",8,10,"c0",67,"q0",66,"c0",70,"q0",69,"o32",7,"o33",7,"o34",7];M._.w()</script><ul><li><a href=https://github.com/LuLaValva><img src=https://avatars.githubusercontent.com/u/26027232?v=4 alt>LuLaValva</a></li><li><a href=https://github.com/marko-js/website-next/blob/main/docs/explanation/immutable-state.md><div><svg viewBox="0 0 448 512"><path d="M256 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 160-160 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l160 0 0 160c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160 160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-160 0 0-160z"></path></svg><!--M_*102 0--></div>You?</a></li></ul></section></article><div class=_de id=page-menu><nav aria-labelledby=sM_1 class=_df id=_dk><ul><li><strong id=sM_1>On this Page</strong></li><li><a href=#immutability>Immutability</a><!--M_*94 0--></li><li><a href=#functional-ui>Functional UI</a><!--M_*95 0--></li><li><a href=#serialization>Serialization</a><!--M_*96 0--></li><li><a href=#further-reading>Further Reading</a><!--M_*97 0--></li></ul></nav></div></main></div><footer id=_a><a href="https://openjsf.org/" class=_b><img src=/assets/openjsf-u4IcyPV8.svg alt> <span><span class=_e>OpenJS&nbsp;</span><span class=_f>Foundation</span></span></a><div class=_g></div><a href=https://github.com/marko-js/marko/blob/main/LICENSE class=_d><img src=/assets/osi-BEF6Mbrt.svg alt> MIT&nbsp;License</a><div class=_g></div><a href=https://github.com/eBay class=_c><img src=/assets/ebay-CSr9mcj_.svg alt=eBay> open&nbsp;source</a></footer><script>M._.r.push(_=>(_.i=[4,{5:{},7:448,8:512}]),"c0",102,"j0",94,95,96,97);M._.w()</script></body></html>