# 細粒度バンドリング

> [!TLDR]
> - Marko はコンパイル時にインタラクティブな JavaScript のみをバンドルする
> - 静的コンテンツにはクライアント側の JavaScript が不要
> - バンドルサイズはアーキテクチャではなく、インタラクティビティに依存する

Marko は**コンパイル時解析**を使用して、テンプレートのどの部分が実際にインタラクティビティを必要とするかを識別することで、最小限の JavaScript バンドルを生成します。コンポーネントツリー全体を配信する代わりに、動的な動作に必要なコードのみがブラウザに到達します。つまり、Marko は**デフォルトで JavaScript ゼロ**であり、インタラクティブなページは真に必要な部分に対してのみ JavaScript を配信します。

## アイランドを超えて

Marko の古いバージョンを含む一部のフレームワークは、各ページバンドル内の JavaScript を削減するために[アイランドアーキテクチャ](https://www.patterns.dev/vanilla/islands-architecture/)を使用しています。アイランドは**コンポーネント**レベルで決定されるため、アイランドベースのフレームワークで作成されたアプリケーションは、_サーバー_コンポーネントと_クライアント_コンポーネントの明確な区別が必要です。

Marko 6 では、コンパイラは_状態_ツリーに基づいてどのコードがインタラクティブかを決定し、ブラウザバンドルに必要なものだけを含めます。インタラクティブな「watch」ボタンを含むこのタグを考えてみましょう：

```marko
/* shop-item.marko */
<div>
  <h3>${input.name}</h3>

  <${input.content}/>

  // インタラクティブなトグル
  <let/watching:=input.watching>
  <button onClick() { watching = !watching }>
    ${watching ? "watching" : "watch"}
  </button>
</div>
```

`watching` をトグルし、ボタンテキストを更新するための JavaScript のみが含まれます。静的コンテンツをレンダリングしたり、ボタン要素を作成したりするための JavaScript は含まれません。

## 自動最適化

Marko のコンパイラは、手動設定なしで何が JavaScript を必要とするかを自動的に判断します。

アプリケーションが1つの大きなコンポーネントとして構造化されているか、多くの小さなコンポーネントに分割されているかにかかわらず、バンドルサイズは同じままです。つまり、コンポーネントアーキテクチャではなく、純粋にインタラクティビティの量によって決定されます。コンパイラは、コードがどのように構成されているかに関係なく、インタラクティブな部分のみを抽出します。このようにして、コンポーネントは[関心の分離](./separation-of-concerns.md)に従って分割できます。

これにより、コンパイルプロセスから自然に優れたパフォーマンスが生まれる開発体験が生まれます。アーキテクチャの決定は保守性と開発者体験に関するものになり、コンパイラが自動的に最適化を処理します。
