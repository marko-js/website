<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="The Marko programming language"><title>HTML Streaming | Marko</title><link rel=icon sizes=32x32 href=/fav.png><link rel=icon type=image/svg+xml href=/fav.svg><link rel=preconnect href=https://GB0QQV5RQM-dsn.algolia.net crossorigin><script async type="module" crossorigin src="/assets/route.marko-gtv5z02Z.js"></script><link rel="modulepreload" crossorigin href="/assets/_9SlcXqTO.js"><link rel="modulepreload" crossorigin href="/assets/_B9VWDNqk.js"><link rel="modulepreload" crossorigin href="/assets/_C2E5ZEJK.js"><link rel="stylesheet" crossorigin href="/assets/_layout-Cns8Y_Cv.css"><link rel="stylesheet" crossorigin href="/assets/_layout-DNG0lPeP.css"><link rel="stylesheet" crossorigin href="/assets/app-code-block-rYAtLWqr.css"></head><body><div id=root><header id=header><a title=Home href="/" id=_cq><picture><source srcset=/logo.svg#dark media=(prefers-color-scheme:dark)><img alt="Marko Logo" src=/logo.svg></picture></a><div class=_co><a href=/docs>Docs</a><a href=/playground>Playground</a><a href=https://github.com/marko-js/marko>GitHub</a></div><button aria-pressed=false aria-label="Show menu" id=_cp></button><!--M_*6 2--><div id=_cr><button disabled aria-hidden=true></button></div><!--M_*6 3--></header><main><script>document.documentElement.classList.toggle("concise-mode",localStorage.getItem("concise-mode")==='true');</script><script>document.documentElement.classList.toggle("ts-mode",localStorage.getItem("ts-mode")==='true');</script><div class=_cV id=site-menu><nav class=_cW id=_cX><ul><li><strong>Introduction</strong><ul><li><a href=/docs/introduction/getting-started><!--M_[13-->Getting Started<!--M_]12 1--></a><!--M_*12 0--></li><li><a href=/docs/introduction/welcome-to-marko><!--M_[15-->Welcome to Marko!<!--M_]14 1--></a><!--M_*14 0--></li><li><a href=/docs/introduction/installation><!--M_[17-->Installation<!--M_]16 1--></a><!--M_*16 0--></li><li><a href=/docs/introduction/why-marko><!--M_[19-->Why Marko?<!--M_]18 1--></a><!--M_*18 0--></li><li><a href=/docs/introduction/integrations><!--M_[21-->Integrations<!--M_]20 1--></a><!--M_*20 0--></li></ul></li><li><strong>Tutorials</strong><ul><li><a href=/docs/tutorial/fundamentals><!--M_[23-->Fundamentals<!--M_]22 1--></a><!--M_*22 0--></li><li><a href=/docs/tutorial/components-and-reactivity><!--M_[25-->Components and Reactivity<!--M_]24 1--></a><!--M_*24 0--></li></ul></li><li><strong>Guides</strong><ul><li><a href=/docs/guide/styling><!--M_[27-->Styling<!--M_]26 1--></a><!--M_*26 0--></li><li><a href=/docs/guide/low-level-apis><!--M_[29-->Low-Level APIs<!--M_]28 1--></a><!--M_*28 0--></li><li><a href=/docs/guide/library-integration><!--M_[31-->Library Integration<!--M_]30 1--></a><!--M_*30 0--></li><li><a href=/docs/guide/marko-5-interop><!--M_[33-->Marko 5 Interop<!--M_]32 1--></a><!--M_*32 0--></li></ul></li><li><strong>Explanation</strong><ul><li><a href=/docs/explanation/streaming aria-current=true><!--M_[35-->Streaming<!--M_]34 1--></a><!--M_*34 0--></li><li><a href=/docs/explanation/targeted-compilation><!--M_[37-->Targeted Compilation<!--M_]36 1--></a><!--M_*36 0--></li><li><a href=/docs/explanation/fine-grained-bundling><!--M_[39-->Fine-Grained Bundling<!--M_]38 1--></a><!--M_*38 0--></li><li><a href=/docs/explanation/separation-of-concerns><!--M_[41-->Separation of Concerns<!--M_]40 1--></a><!--M_*40 0--></li><li><a href=/docs/explanation/controllable-components><!--M_[43-->Controllable Components<!--M_]42 1--></a><!--M_*42 0--></li><li><a href=/docs/explanation/nested-reactivity><!--M_[45-->Nested Reactivity<!--M_]44 1--></a><!--M_*44 0--></li><li><a href=/docs/explanation/immutable-state><!--M_[47-->Immutable State<!--M_]46 1--></a><!--M_*46 0--></li><li><a href=/docs/explanation/serializable-state><!--M_[49-->Serializable State<!--M_]48 1--></a><!--M_*48 0--></li></ul></li><li><strong>Reference</strong><ul><li><a href=/docs/reference/language><!--M_[51-->Language<!--M_]50 1--></a><!--M_*50 0--></li><li><a href=/docs/reference/custom-tag><!--M_[53-->Custom Tags<!--M_]52 1--></a><!--M_*52 0--></li><li><a href=/docs/reference/reactivity><!--M_[55-->Reactivity<!--M_]54 1--></a><!--M_*54 0--></li><li><a href=/docs/reference/core-tag><!--M_[57-->Core Tags<!--M_]56 1--></a><!--M_*56 0--></li><li><a href=/docs/reference/native-tag><!--M_[59-->Native Tags<!--M_]58 1--></a><!--M_*58 0--></li><li><a href=/docs/reference/concise-syntax><!--M_[61-->Concise Syntax<!--M_]60 1--></a><!--M_*60 0--></li><li><a href=/docs/reference/template><!--M_[63-->Template API<!--M_]62 1--></a><!--M_*62 0--></li><li><a href=/docs/reference/typescript><!--M_[65-->TypeScript<!--M_]64 1--></a><!--M_*64 0--></li></ul></li><li><strong>Marko Run</strong><ul><li><a href=/docs/marko-run/getting-started><!--M_[67-->Getting Started<!--M_]66 1--></a><!--M_*66 0--></li><li><a href=/docs/marko-run/file-based-routing><!--M_[69-->File-based Routing<!--M_]68 1--></a><!--M_*68 0--></li><li><a href=/docs/marko-run/typescript><!--M_[71-->TypeScript<!--M_]70 1--></a><!--M_*70 0--></li></ul></li></ul></nav><div id=_cZ><strong id=sM_1>Settings</strong><label class=_n><span>HTML<!--M_*72 1--></span><span class=_m><input type=checkbox aria-labelledby=sM_1><!--M_*72 3--><svg viewBox="0 0 576 512"><path d="M384 128c70.7 0 128 57.3 128 128S454.7 384 384 384l-192 0c-70.7 0-128-57.3-128-128s57.3-128 128-128l192 0zM576 256c0-106-86-192-192-192L192 64C86 64 0 150 0 256S86 448 192 448l192 0c106 0 192-86 192-192zM192 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"></path></svg><!--M_*73 0--></span><span>Concise<!--M_*72 5--></span></label><label class=_n><span>JS<!--M_*75 1--></span><span class=_m><input type=checkbox aria-labelledby=sM_1><!--M_*75 3--><svg viewBox="0 0 576 512"><path d="M384 128c70.7 0 128 57.3 128 128S454.7 384 384 384l-192 0c-70.7 0-128-57.3-128-128s57.3-128 128-128l192 0zM576 256c0-106-86-192-192-192L192 64C86 64 0 150 0 256S86 448 192 448l192 0c106 0 192-86 192-192zM192 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"></path></svg><!--M_*76 0--></span><span>TS<!--M_*75 5--></span></label></div></div><article id=_c1><h1 id=html-streaming>HTML Streaming</h1><callout role=note aria-labelledby=callout-cot-0 class=admonition-tldr><cot id=callout-cot-0>TL;DR</cot><ul><li>HTML streaming sends content to browsers incrementally</li><li><code>&lt;await></code> and <code>&lt;try></code> tags enable async rendering</li><li>Built-in error handling and loading states are included</li></ul></callout><p>Marko provides a powerful, yet simple, declarative approach to HTML streaming via <code>&lt;await></code> and <code>&lt;try></code> to improve perceived and real performance of your pages.</p><p>Streaming is the process of transmitting data incrementally as it’s generated. On the web, <strong>HTML streaming</strong> means sending HTML to the browser chunk-by-chunk, as soon as it&#39;s ready, rather than waiting until the entire document is completed.</p><p>In contrast, <strong>buffering</strong> means generating the full HTML page first, and only then sending it to the browser.</p><section id=background--history><h2><a href=#background--history>Background &amp; History</a></h2><ul><li><p><strong>Origins of Progressive Rendering</strong></p><ul><li>Browsers supported progressive rendering—the ability to render an partial HTML page—as early as Netscape Navigator 1.0 released in 1994</li><li>Chunked transfer encoding—enabling servers to send a partial response—was introduced as part of HTTP/1.1 in 1999<ul><li>HTTP/2 and HTTP/3 are chunked (technically <a href=https://httpwg.org/specs/rfc7540.html#:~:text=of%20the%20connection.-,frame,-%3A>framed</a>) by default</li></ul></li><li>Although supported at the protocol level, most high level web libraries across most programming languages have buffered HTML responses</li><li>Within the JS ecosystem we&#39;ve only seen HTML streaming become more mainstream in the 2020s</li></ul></li><li><p><strong>Marko’s Streaming History</strong></p><ul><li>Marko has supported streaming <a href="https://innovation.ebayinc.com/stories/async-fragments-rediscovering-progressive-html-rendering-with-marko/">since its inception in 2014</a></li></ul></li></ul><section id=types-of-html-streaming><h3><a href=#types-of-html-streaming>Types of HTML Streaming</a></h3><ul><li><p><strong>In-order streaming</strong></p><ul><li>HTML arrives in the exact order of document structure.</li></ul></li><li><p><strong>Out-of-order streaming</strong></p><ul><li>HTML fragments arrive as data becomes ready, even if out of sequence.</li><li>Requires minimal JavaScript client-side to rearrange HTML in correct order.</li></ul></li></ul></section></section><section id=benefits-of-streaming><h2><a href=#benefits-of-streaming>Benefits of Streaming</a></h2><section id=perceived-performance-user-experience><h3><a href=#perceived-performance-user-experience>Perceived Performance (User Experience)</a></h3><ul><li>Users see content immediately, improving engagement.</li><li>Reduces perceived loading times significantly by showing progressive content.</li></ul></section><section id=real-performance-network--rendering><h3><a href=#real-performance-network--rendering>Real Performance (Network &amp; Rendering)</a></h3><ul><li><strong>Faster Time to First Byte (TTFB)</strong> Content starts arriving sooner, browsers begin parsing immediately.</li><li><strong>Earlier Asset Downloads</strong> CSS, fonts, and JavaScript can begin downloading before the entire page HTML completes.</li><li><strong>Improved Time to Interactive (TTI)</strong> Users can start interacting with visible components faster.</li></ul></section><section id=reduced-server-load><h3><a href=#reduced-server-load>Reduced Server Load</a></h3><ul><li>Incremental streaming reduces memory usage.</li><li>Lower latency and increased throughput.</li></ul></section></section><section id=how-to-stream-using-marko-6><h2><a href=#how-to-stream-using-marko-6>How to Stream using Marko 6</a></h2><p>Marko provides intuitive built-in tags to handle asynchronous HTML generation and streaming:</p><section id=await><h3><a href=#await><code>&lt;await></code></a></h3><p>Wait for a promise to render a section of the template</p><p><strong>Syntax example:</strong></p><div class=code-block><div class=html><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_0">&#x3C;</span><span class="s_1">await</span><span class="s_0">|</span><span class="s_2">user</span><span class="s_0">|</span><span class="s_3">=</span><span class="s_4">getUser</span><span class="s_0">()></span></span>
<span class="line"><span class="s_0">  &#x3C;</span><span class="s_1">img</span><span class="s_5"> src</span><span class="s_3">=user</span><span class="s_0">.</span><span class="s_3">avatar</span><span class="s_0">></span></span>
<span class="line"><span class="s_6">  ${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span>
<span class="line"><span class="s_0">&#x3C;/</span><span class="s_1">await</span><span class="s_0">></span></span></code></pre></div><div class=concise><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_1">await</span><span class="s_0">|</span><span class="s_2">user</span><span class="s_0">|</span><span class="s_3">=</span><span class="s_4">getUser</span><span class="s_0">()</span></span>
<span class="line"><span class="s_1">  img</span><span class="s_5"> src</span><span class="s_3">=user</span><span class="s_0">.</span><span class="s_3">avatar</span></span>
<span class="line"><span class="s_0">  -- </span><span class="s_6">${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span></code></pre></div><div class=html-ts><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_0">&#x3C;</span><span class="s_1">await</span><span class="s_0">|</span><span class="s_2">user</span><span class="s_0">|</span><span class="s_3">=</span><span class="s_4">getUser</span><span class="s_0">()></span></span>
<span class="line"><span class="s_0">  &#x3C;</span><span class="s_1">img</span><span class="s_5"> src</span><span class="s_3">=user</span><span class="s_0">.</span><span class="s_3">avatar</span><span class="s_0">></span></span>
<span class="line"><span class="s_6">  ${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span>
<span class="line"><span class="s_0">&#x3C;/</span><span class="s_1">await</span><span class="s_0">></span></span></code></pre></div><div class=concise-ts><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_1">await</span><span class="s_0">|</span><span class="s_2">user</span><span class="s_0">|</span><span class="s_3">=</span><span class="s_4">getUser</span><span class="s_0">()</span></span>
<span class="line"><span class="s_1">  img</span><span class="s_5"> src</span><span class="s_3">=user</span><span class="s_0">.</span><span class="s_3">avatar</span></span>
<span class="line"><span class="s_0">  -- </span><span class="s_6">${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span></code></pre></div></div><style>.s_0{--shiki-light:#202124;--shiki-dark:#FFF}.s_1{--shiki-light:#D91880;--shiki-dark:#FF4185}.s_2{--shiki-light:#B05C1C;--shiki-light-font-style:italic;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic}.s_3{--shiki-light:#202124;--shiki-dark:#FFFFFF}.s_4{--shiki-light:#1D8649;--shiki-dark:#7FFF00}.s_5{--shiki-light:#46821C;--shiki-dark:#A6E22E}.s_6{--shiki-light:#0D7BBF;--shiki-dark:#66D9EF}.s_7{--shiki-light:#202124;--shiki-dark:#FFF;--shiki-light-bg:#00000000;--shiki-dark-bg:#00000000}</style><ul><li>Marko will flush as much HTML content as possible up to an <code>&lt;await></code></li><li>Upon resolution of <code>getUser()</code>, the remaining HTML will be flushed</li></ul></section><section id=try><h3><a href=#try><code>&lt;try></code></a></h3><p>Manage asynchronous boundaries, handle loading states, and gracefully catch errors within streaming (and non-streaming) HTML.</p><p><strong>Basic syntax:</strong></p><div class=code-block><div class=html><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_0">&#x3C;</span><span class="s_1">try</span><span class="s_0">></span></span>
<span class="line"></span>
<span class="line"><span class="s_0">  &#x3C;</span><span class="s_5">@placeholder</span><span class="s_0">>Loading...&#x3C;/</span><span class="s_5">@placeholder</span><span class="s_0">></span></span>
<span class="line"></span>
<span class="line"><span class="s_8">  &#x3C;@</span><span class="s_5">catch</span><span class="s_8">|</span><span class="s_5">err</span><span class="s_8">|</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">    Error: </span><span class="s_6">${</span><span class="s_3">err</span><span class="s_0">.</span><span class="s_3">message</span><span class="s_6">}</span></span>
<span class="line"><span class="s_0">  &#x3C;/</span><span class="s_5">@catch</span><span class="s_0">></span></span>
<span class="line"><span class="s_8">  &#x3C;</span><span class="s_5">await</span><span class="s_8">|</span><span class="s_5">user</span><span class="s_8">|=</span><span class="s_5">getUser</span><span class="s_0">()></span></span>
<span class="line"><span class="s_6">    ${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span>
<span class="line"><span class="s_0">  &#x3C;/</span><span class="s_1">await</span><span class="s_0">></span></span>
<span class="line"><span class="s_8">&#x3C;/</span><span class="s_5">try</span><span class="s_0">></span></span></code></pre></div><div class=concise><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_1">try</span></span>
<span class="line"></span>
<span class="line"><span class="s_5">  @placeholder</span><span class="s_0"> -- Loading...</span></span>
<span class="line"></span>
<span class="line"><span class="s_5">  @catch</span><span class="s_0">|</span><span class="s_2">err</span><span class="s_0">| -- Error: </span><span class="s_6">${</span><span class="s_3">err</span><span class="s_0">.</span><span class="s_3">message</span><span class="s_6">}</span></span>
<span class="line"><span class="s_1">  await</span><span class="s_0">|</span><span class="s_2">user</span><span class="s_0">|</span><span class="s_3">=</span><span class="s_4">getUser</span><span class="s_0">() -- </span><span class="s_6">${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span></code></pre></div><div class=html-ts><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_0">&#x3C;</span><span class="s_1">try</span><span class="s_0">></span></span>
<span class="line"></span>
<span class="line"><span class="s_0">  &#x3C;</span><span class="s_5">@placeholder</span><span class="s_0">>Loading...&#x3C;/</span><span class="s_5">@placeholder</span><span class="s_0">></span></span>
<span class="line"></span>
<span class="line"><span class="s_8">  &#x3C;@</span><span class="s_5">catch</span><span class="s_8">|</span><span class="s_5">err</span><span class="s_8">|</span><span class="s_0">></span></span>
<span class="line"><span class="s_0">    Error: </span><span class="s_6">${</span><span class="s_3">err</span><span class="s_0">.</span><span class="s_3">message</span><span class="s_6">}</span></span>
<span class="line"><span class="s_0">  &#x3C;/</span><span class="s_5">@catch</span><span class="s_0">></span></span>
<span class="line"><span class="s_8">  &#x3C;</span><span class="s_5">await</span><span class="s_8">|</span><span class="s_5">user</span><span class="s_8">|=</span><span class="s_5">getUser</span><span class="s_0">()></span></span>
<span class="line"><span class="s_6">    ${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span>
<span class="line"><span class="s_0">  &#x3C;/</span><span class="s_1">await</span><span class="s_0">></span></span>
<span class="line"><span class="s_8">&#x3C;/</span><span class="s_5">try</span><span class="s_0">></span></span></code></pre></div><div class=concise-ts><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_1">try</span></span>
<span class="line"></span>
<span class="line"><span class="s_5">  @placeholder</span><span class="s_0"> -- Loading...</span></span>
<span class="line"></span>
<span class="line"><span class="s_5">  @catch</span><span class="s_0">|</span><span class="s_2">err</span><span class="s_0">| -- Error: </span><span class="s_6">${</span><span class="s_3">err</span><span class="s_0">.</span><span class="s_3">message</span><span class="s_6">}</span></span>
<span class="line"><span class="s_1">  await</span><span class="s_0">|</span><span class="s_2">user</span><span class="s_0">|</span><span class="s_3">=</span><span class="s_4">getUser</span><span class="s_0">() -- </span><span class="s_6">${</span><span class="s_3">user</span><span class="s_0">.</span><span class="s_3">name</span><span class="s_6">}</span></span></code></pre></div></div><style>.s_8{--shiki-light:#202124;--shiki-dark:#F8F8F0}</style><section id=placeholder><h4><a href=#placeholder><code>@placeholder</code></a></h4><ul><li>Provides temporary content displayed immediately while asynchronous data is loading.</li><li>Opts into out of order rendering.<ul><li>Marko supports rendering HTML fragments as soon as they’re ready, regardless of document order.</li><li>Automatically inserts minimal JavaScript to rearrange DOM elements on the client-side for correct final positioning.</li></ul></li></ul></section><section id=catch><h4><a href=#catch><code>@catch</code></a></h4><ul><li>Captures and handles runtime errors occurring within rendered content, preventing the entire page from breaking.</li></ul></section></section></section><section id=troubleshooting--common-pitfalls><h2><a href=#troubleshooting--common-pitfalls>Troubleshooting &amp; Common Pitfalls</a></h2><section id=avoiding-layout-shift-cls><h3><a href=#avoiding-layout-shift-cls>Avoiding Layout Shift (CLS)</a></h3><p>Out-of-order streaming involves temporary placeholders being replaced with real content once it is ready. If not handled properly, this can cause content the user is reading or interacting with to shift, leading to a poor user experience.</p><ul><li>Use placeholders that reserve the correct amount of space.</li><li>Utilize loading indicators/skeleton screens that accurately represent the content.</li><li>Fallback to in-order streaming where it makes sense or content size cannot be determined</li></ul></section><section id=avoiding-buffering><h3><a href=#avoiding-buffering>Avoiding Buffering</a></h3><p>Even though streaming has been supported on the web for decades and more tools are utilizing it, you may still find that some default configurations of third parties may assume a buffered response. Here are some known culprits that may buffer your server’s output HTTP streams:</p><section id=reverse-proxiesload-balancers><h4><a href=#reverse-proxiesload-balancers>Reverse proxies/load balancers</a></h4><ul><li>Turn off proxy buffering, or if you can’t, set the proxy buffer sizes to be reasonably small.</li><li>Make sure the “upstream” HTTP version is 1.1 or higher; HTTP/1.0 and lower do not support streaming.</li><li>Some software doesn’t support HTTP/2 or higher “upstream” connections at all or very well — if your Node server uses HTTP/2, you may need to downgrade.</li><li>Check if “upstream” connections are <code>keep-alive</code>: overhead from closing and reopening connections may delay responses.</li><li>For typical modern webpage filesizes, the following bullet points probably won’t matter. But if you want to stream <strong>small chunks of data with the lowest latency</strong>, investigate these sources of buffering:<ul><li>Automatic gzip/brotli compression may have their buffer sizes set too high; you can tune their buffers to be smaller for faster streaming in exchange for slightly worse compression.</li><li>You can <a href=https://hpbn.co/transport-layer-security-tls/#optimize-tls-record-size>tune HTTPS record sizes for lower latency, as described in High Performance Browser Networking</a>.</li><li>Turning off MIME sniffing with <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options>the <code>X-Content-Type-Options</code></a> header eliminates browser buffering at the very beginning of HTTP responses</li></ul></li></ul><details><summary><strong>NGiNX</strong></summary><p>Most of NGiNX’s relevant parameters are inside <a href=https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering>its builtin <code>http_proxy</code> module</a>:</p><div class=code-block><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span>proxy_http_version 1.1; # 1.0 by default</span></span>
<span class="line"><span>proxy_buffering off; # on by default</span></span></code></pre></div></details><details><summary><strong>Apache</strong></summary><p>Apache’s default configuration works fine with streaming, but your host may have it configured differently. The relevant Apache configuration is inside <a href=https://httpd.apache.org/docs/2.4/mod/mod_proxy.html>its <code>mod_proxy</code> and <code>mod_proxy_*</code> modules</a> and their <a href=https://httpd.apache.org/docs/2.4/env.html>associated environment variables</a>.</p></details></section><section id=cdns><h4><a href=#cdns>CDNs</a></h4><p>Content Delivery Networks (CDNs) consider efficient streaming one of their best features, but it may be off by default or if certain features are enabled.</p><details><summary><strong>Fastly (Varnish)</strong></summary><p>For Fastly or another provider that uses VCL configuration, check <a href="https://developer.fastly.com/reference/vcl/variables/backend-response/beresp-do-stream/">if backend responses have <code>beresp.do_stream = true</code> set</a>.</p></details><details><summary><strong>Akamai</strong></summary><p>Some <a href=https://community.akamai.com/customers/s/question/0D50f00006n975d/enabling-chunked-transfer-encoding-responses>Akamai features designed to mitigate slow backends can ironically slow down fast chunked responses</a>. Try toggling off Adaptive Acceleration, Ion, mPulse, Prefetch, and/or similar performance features. Also check for the following in the configuration:</p><div class=code-block><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span>&#x3C;network:http.buffer-response-v2>off&#x3C;/network:http.buffer-response-v2></span></span></code></pre></div></details></section><section id=nodejs-itself><h4><a href=#nodejs-itself>Node.js itself</a></h4><p>For extreme cases where <a href=https://github.com/marko-js/marko/pull/1641>Node streams very small HTML chunks with its built-in compression modules</a>, you may need to tweak the compressor stream settings. Here’s an example with <code>createGzip</code> and its <code>Z_PARTIAL_FLUSH</code> flag:</p><div class=code-block><pre class="shiki shiki-themes marko-light marko-dark s_7" tabindex="0"><code><span class="line"><span class="s_1">import</span><span class="s_3"> http</span><span class="s_1"> from</span><span class="s_9"> "http"</span><span class="s_0">;</span></span>
<span class="line"><span class="s_1">import</span><span class="s_3"> zlib</span><span class="s_1"> from</span><span class="s_9"> "zlib"</span><span class="s_0">;</span></span>
<span class="line"></span>
<span class="line"><span class="s_1">import</span><span class="s_3"> MarkoTemplate</span><span class="s_1"> from</span><span class="s_9"> "./something.marko"</span><span class="s_0">;</span></span>
<span class="line"></span>
<span class="line"><span class="s_3">http</span></span>
<span class="line"><span class="s_0">  .</span><span class="s_4">createServer</span><span class="s_0">(</span><span class="s_a">function</span><span class="s_0"> (</span><span class="s_2">request</span><span class="s_0">, </span><span class="s_2">response</span><span class="s_0">) {</span></span>
<span class="line"><span class="s_3">    response</span><span class="s_0">.</span><span class="s_4">writeHead</span><span class="s_0">(</span><span class="s_b">200</span><span class="s_0">, { </span><span class="s_9">"content-type"</span><span class="s_0">: </span><span class="s_9">"text/html;charset=utf-8"</span><span class="s_0"> });</span></span>
<span class="line"><span class="s_a">    const</span><span class="s_3"> templateStream</span><span class="s_3"> =</span><span class="s_3"> MarkoTemplate</span><span class="s_0">.</span><span class="s_4">stream</span><span class="s_0">({});</span></span>
<span class="line"><span class="s_a">    const</span><span class="s_3"> gzipStream</span><span class="s_3"> =</span><span class="s_3"> zlib</span><span class="s_0">.</span><span class="s_4">createGzip</span><span class="s_0">({</span></span>
<span class="line"><span class="s_0">      flush: </span><span class="s_3">zlib</span><span class="s_0">.</span><span class="s_3">constants</span><span class="s_0">.</span><span class="s_3">Z_PARTIAL_FLUSH</span><span class="s_0">,</span></span>
<span class="line"><span class="s_0">    });</span></span>
<span class="line"><span class="s_3">    templateStream</span><span class="s_0">.</span><span class="s_4">pipe</span><span class="s_0">(</span><span class="s_3">outputStream</span><span class="s_0">).</span><span class="s_4">pipe</span><span class="s_0">(</span><span class="s_3">response</span><span class="s_0">);</span></span>
<span class="line"><span class="s_0">  })</span></span>
<span class="line"><span class="s_0">  .</span><span class="s_4">listen</span><span class="s_0">(</span><span class="s_b">80</span><span class="s_0">);</span></span></code></pre></div><style>.s_9{--shiki-light:#8A720A;--shiki-dark:#FFF066}.s_a{--shiki-light:#0D7BBF;--shiki-light-font-style:italic;--shiki-dark:#5BD7FF;--shiki-dark-font-style:italic}.s_b{--shiki-light:#7C4DFF;--shiki-dark:#AE81FF}</style></section></section></section><hr><section id=_c2><h2 id=contributors><a href=#contributors>Contributors</a></h2><p>Helpful? You can thank these awesome people! You can also edit this doc if you see any issues or want to improve it.</p><script>(e=>(self[e]=(l,d=e+l,f=d.length,o={},n=[],s=document,t=s.createTreeWalker(s,129))=>s=self[e][l]={i:d,d:s,l:o,v:n,x(){},w(e,l,x){for(;e=t.nextNode();)s.x(l=(l=e.data)&&!l.indexOf(d)&&(o[x=l.slice(f+1)]=e,l[f]),x,e),l>"#"&&n.push(e)}},self[e]))("M")("_");M._.r=[_=>(_.Kb=[{params:{},url:new URL("http://localhost/docs/explanation/streaming")},5,{4:!1},_.b={0:_.a={3:"concise-mode"},1:9,3:_.c={3:"ts-mode"},4:11,40:_.e={10:_.d={"aria-labelledby":"sM_1",checked:!1},f3:0},41:_.g={10:_.f={"aria-labelledby":"sM_1",checked:!1},f3:0},42:!1,43:!1,45:"sM_1"},_.a,1,_.c,1,{d1:_.h={},c1:"n5"},_.h,{d1:_.i={},c1:"n6"},_.i,{d1:_.j={},c1:"n7"},_.j,{d1:_.k={},c1:"n8"},_.k,{d1:_.l={},c1:"n9"},_.l,{d1:_.m={},c1:"n10"},_.m,{d1:_.n={},c1:"n11"},_.n,{d1:_.o={},c1:"n12"},_.o,{d1:_.p={},c1:"n13"},_.p,{d1:_.q={},c1:"n14"},_.q,{d1:_.r={},c1:"n15"},_.r,{d1:_.s={},c1:"n16"},_.s,{d1:_.t={},c1:"n17"},_.t,{d1:_.u={},c1:"n18"},_.u,{d1:_.v={},c1:"n19"},_.v,{d1:_.w={},c1:"n20"},_.w,{d1:_.x={},c1:"n21"},_.x,{d1:_.y={},c1:"n22"},_.y,{d1:_.z={},c1:"n23"},_.z,{d1:_.A={},c1:"n24"},_.A,{d1:_.B={},c1:"n25"},_.B,{d1:_.C={},c1:"n26"},_.C,{d1:_.D={},c1:"n27"},_.D,{d1:_.E={},c1:"n28"},_.E,{d1:_.F={},c1:"n29"},_.F,{d1:_.G={},c1:"n30"},_.G,{d1:_.H={},c1:"n31"},_.H,{d1:_.I={},c1:"n32"},_.I,{d1:_.J={},c1:"n33"},_.J,{d1:_.K={},c1:"n34"},_.K,_.e,{5:{},7:576,8:512},1,_.g,{5:{},7:576,8:512},2,_.L={11:_.M={}},2,{6:"marko"},2,{6:"marko"},2,{6:""},1,{6:""},1,{6:"js"},2,_.U={m0:new Map(_.N=[[0,_.S={5:"background--history",7:[{id:"types-of-html-streaming",title:"Types of HTML Streaming",children:_.P=[]}],c2:0,d2:_.T={d0:_.Q={m0:new Map(_.O=[[0,_.R={5:"types-of-html-streaming",7:_.P}]]),_:_.L},c0:"i1"}}],[1,_.cb={5:"benefits-of-streaming",7:[{id:"perceived-performance-user-experience",title:"Perceived Performance (User Experience)",children:_.W=[]},{id:"real-performance-network--rendering",title:"Real Performance (Network & Rendering)",children:_.Z=[]},{id:"reduced-server-load",title:"Reduced Server Load",children:_.ab=[]}],c2:0,d2:_.db={d0:_.X={m0:new Map(_.V=[[0,_.Y={5:"perceived-performance-user-experience",7:_.W}],[1,_.$={5:"real-performance-network--rendering",7:_.Z}],[2,_.bb={5:"reduced-server-load",7:_.ab}]]),_:_.L},c0:"i1"}}],[2,_.rb={5:"how-to-stream-using-marko-6",7:[{id:"await",title:"\x3Cawait>",children:_.fb=[]},{id:"try",title:"\x3Ctry>",children:_.ib=[{id:"placeholder",title:"@placeholder",children:_.kb=[]},{id:"catch",title:"@catch",children:_.nb=[]}]}],c2:0,d2:_.sb={d0:_.gb={m0:new Map(_.eb=[[0,_.hb={5:"await",7:_.fb}],[1,_.pb={5:"try",7:_.ib,c2:0,d2:_.qb={d0:_.lb={m0:new Map(_.jb=[[0,_.mb={5:"placeholder",7:_.kb}],[1,_.ob={5:"catch",7:_.nb}]]),_:_.L},c0:"i1"}}]]),_:_.L},c0:"i1"}}],[3,_.Ib={5:"troubleshooting--common-pitfalls",7:[{id:"avoiding-layout-shift-cls",title:"Avoiding Layout Shift (CLS)",children:_.ub=[]},{id:"avoiding-buffering",title:"Avoiding Buffering",children:_.xb=[{id:"reverse-proxiesload-balancers",title:"Reverse proxies/load balancers",children:_.zb=[]},{id:"cdns",title:"CDNs",children:_.Cb=[]},{id:"nodejs-itself",title:"Node.js itself",children:_.Eb=[]}]}],c2:0,d2:_.Jb={d0:_.vb={m0:new Map(_.tb=[[0,_.wb={5:"avoiding-layout-shift-cls",7:_.ub}],[1,_.Gb={5:"avoiding-buffering",7:_.xb,c2:0,d2:_.Hb={d0:_.Ab={m0:new Map(_.yb=[[0,_.Bb={5:"reverse-proxiesload-balancers",7:_.zb}],[1,_.Db={5:"cdns",7:_.Cb}],[2,_.Fb={5:"nodejs-itself",7:_.Eb}]]),_:_.L},c0:"i1"}}]]),_:_.L},c0:"i1"}}]]),_:_.L},_.S,_.T,_.Q,_.R,_.cb,_.db,_.X,_.Y,_.$,_.bb,_.rb,_.sb,_.gb,_.hb,_.pb,_.qb,_.lb,_.mb,_.ob,_.Ib,_.Jb,_.vb,_.wb,_.Gb,_.Hb,_.Ab,_.Bb,_.Db,_.Fb],_.R._=_.Q,_.T._=_.S,_.S._=_.cb._=_.rb._=_.Ib._=_.U,_.Y._=_.$._=_.bb._=_.X,_.db._=_.cb,_.hb._=_.pb._=_.gb,_.mb._=_.ob._=_.lb,_.qb._=_.pb,_.sb._=_.rb,_.wb._=_.Gb._=_.vb,_.Bb._=_.Db._=_.Fb._=_.Ab,_.Hb._=_.Gb,_.Jb._=_.Ib,_.a.f=_._.d0(_.a),_.a.e=_._.n2(_.b),_.c.f=_._.d0(_.c),_.c.e=_._.n3(_.b),_.d.checkedChange=_.e.e3=_._.n0(_.b),_.f.checkedChange=_.g.e3=_._.n1(_.b),_.M.content=_._.i1(_.L),_.Kb),"g0",5,"m0",6,"m1",6,"d1",8,10,"b0",73,"p0",72,"b0",76,"p0",75,"n35",7,"n36",7];M._.w()</script><ul><li><a href=https://github.com/LuLaValva><img src=https://avatars.githubusercontent.com/u/26027232?v=4 alt>LuLaValva</a></li><li><a href=https://github.com/mlrawlings><img src=https://avatars.githubusercontent.com/u/1958812?v=4 alt>mlrawlings</a></li><li><a href=https://github.com/marko-js/website-next/blob/main/docs/explanation/streaming.md><div><svg viewBox="0 0 448 512"><path d="M256 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 160-160 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l160 0 0 160c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160 160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-160 0 0-160z"></path></svg><!--M_*130 0--></div>You?</a></li></ul></section></article><div class=_cV id=page-menu><nav aria-labelledby=sM_2 class=_cW id=_c0><ul><li><strong id=sM_2>On this Page</strong></li><li><a href=#background--history>Background &amp; History<!--M_*96 1--></a><!--M_*96 0--><ul><!--M_[98--><li><a href=#types-of-html-streaming>Types of HTML Streaming<!--M_*99 1--></a><!--M_*99 0--><!--M_|99 2--></li><!--M_|98 0 99--><!--M_]97 0--></ul><!--M_|96 2 97--></li><li><a href=#benefits-of-streaming>Benefits of Streaming<!--M_*100 1--></a><!--M_*100 0--><ul><!--M_[102--><li><a href=#perceived-performance-user-experience>Perceived Performance (User Experience)<!--M_*103 1--></a><!--M_*103 0--><!--M_|103 2--></li><li><a href=#real-performance-network--rendering>Real Performance (Network &amp; Rendering)<!--M_*104 1--></a><!--M_*104 0--><!--M_|104 2--></li><li><a href=#reduced-server-load>Reduced Server Load<!--M_*105 1--></a><!--M_*105 0--><!--M_|105 2--></li><!--M_|102 0 105 104 103--><!--M_]101 0--></ul><!--M_|100 2 101--></li><li><a href=#how-to-stream-using-marko-6>How to Stream using Marko 6<!--M_*106 1--></a><!--M_*106 0--><ul><!--M_[108--><li><a href=#await>&lt;await><!--M_*109 1--></a><!--M_*109 0--><!--M_|109 2--></li><li><a href=#try>&lt;try><!--M_*110 1--></a><!--M_*110 0--><ul><!--M_[112--><li><a href=#placeholder>@placeholder<!--M_*113 1--></a><!--M_*113 0--><!--M_|113 2--></li><li><a href=#catch>@catch<!--M_*114 1--></a><!--M_*114 0--><!--M_|114 2--></li><!--M_|112 0 114 113--><!--M_]111 0--></ul><!--M_|110 2 111--></li><!--M_|108 0 110 109--><!--M_]107 0--></ul><!--M_|106 2 107--></li><li><a href=#troubleshooting--common-pitfalls>Troubleshooting &amp; Common Pitfalls<!--M_*115 1--></a><!--M_*115 0--><ul><!--M_[117--><li><a href=#avoiding-layout-shift-cls>Avoiding Layout Shift (CLS)<!--M_*118 1--></a><!--M_*118 0--><!--M_|118 2--></li><li><a href=#avoiding-buffering>Avoiding Buffering<!--M_*119 1--></a><!--M_*119 0--><ul><!--M_[121--><li><a href=#reverse-proxiesload-balancers>Reverse proxies/load balancers<!--M_*122 1--></a><!--M_*122 0--><!--M_|122 2--></li><li><a href=#cdns>CDNs<!--M_*123 1--></a><!--M_*123 0--><!--M_|123 2--></li><li><a href=#nodejs-itself>Node.js itself<!--M_*124 1--></a><!--M_*124 0--><!--M_|124 2--></li><!--M_|121 0 124 123 122--><!--M_]120 0--></ul><!--M_|119 2 120--></li><!--M_|117 0 119 118--><!--M_]116 0--></ul><!--M_|115 2 116--></li><!--M_|95 0 115 106 100 96--></ul></nav></div></main></div><footer id=_a><a href="https://openjsf.org/" class=_b><img src=/assets/openjsf-u4IcyPV8.svg alt> <span><span class=_e>OpenJS&nbsp;</span><span class=_f>Foundation</span></span></a><div class=_g></div><a href=https://github.com/marko-js/marko/blob/main/LICENSE class=_d><img src=/assets/osi-BEF6Mbrt.svg alt> MIT&nbsp;License</a><div class=_g></div><a href=https://github.com/eBay class=_c><img src=/assets/ebay-CSr9mcj_.svg alt=eBay> open&nbsp;source</a></footer><script>M._.r.push(_=>(_.Lb=[5,{5:{},7:448,8:512}]),"b0",130,"i0",99,96,103,104,105,100,109,113,114,110,106,118,122,123,124,119,115);M._.w()</script></body></html>