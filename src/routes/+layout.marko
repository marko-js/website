<!DOCTYPE html>
html lang="en"
  head
    meta charset="UTF-8"
    meta name="viewport" content="width=device-width, initial-scale=1.0"
    meta name="description" content="The Marko programming language"
    title
      if=typeof ($global.meta as any).pageTitle === "string"
        -- ${($global.meta as any).pageTitle} | 
      -- Marko

    link rel="icon" sizes="32x32" href="/fav.png"
    link rel="icon" type="image/svg+xml" href="/fav.svg"
    link rel="preconnect" href="https://GB0QQV5RQM-dsn.algolia.net" crossorigin

  body
    #root
      app-header
      main
        app-menu
        ${input.content}

    if=!($global.meta as any).hideFooter
      app-footer

static function isAnchorEvent(e: Event): e is Event & { target: HTMLAnchorElement } {
  return (e.target as HTMLElement)?.tagName === "A";
}

static const prefetchedLinks = new WeakSet<HTMLAnchorElement>();

static function prefetch(e: Event) {
  if (isAnchorEvent(e) && new URL(e.target.href, window.location.href).origin === window.location.origin) {
    if (prefetchedLinks.has(e.target)) {
      return;
    }
    
    prefetchedLinks.add(e.target);
    const link = document.createElement('link');
    link.rel = 'prefetch';
    link.href = e.target.href;
    document.head.appendChild(link);
  }
}

script --
  document.addEventListener("mouseover", prefetch, { signal: $signal });
  document.addEventListener("touchstart", prefetch, { signal: $signal });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      prefetch(e);
    }
  }, { signal: $signal });